<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Order - E-commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <style>
        .step-active .step-circle { background-color: #4f46e5; border-color: #4f46e5; color: white; }
        .step-completed .step-circle { background-color: #10b981; border-color: #10b981; color: white; }
        .step-line { transition: width 0.5s ease-in-out; }
        @keyframes pulse-ring { 0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); } 100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); } }
        .animate-pulse-ring { animation: pulse-ring 2s infinite; }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">
    <div id="navbar-placeholder"></div>

    <div class="container mx-auto px-4 py-12 flex-grow max-w-4xl">
        <div class="text-center mb-10">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Track Your Order</h2>
            <p class="text-gray-500">Enter the Order ID you received at checkout.</p>
        </div>

        <div class="bg-white p-8 rounded-2xl shadow-lg mb-8">
            <div class="flex flex-col md:flex-row gap-4 justify-center items-center mb-8">
                <input type="text" id="order-id-input" placeholder="e.g., ORD-88592" class="w-full md:w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 text-center uppercase font-mono tracking-wider">
                <button onclick="trackOrder()" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition shadow-md">
                    TRACK
                </button>
            </div>
            
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 text-center">
                <strong class="font-bold">Order not found!</strong>
                <span class="block sm:inline"> Please make a purchase first to get a valid Order ID.</span>
            </div>

            <div id="tracking-result" class="hidden opacity-0 transition-opacity duration-500">
                <div class="flex justify-between items-center border-b pb-4 mb-8">
                    <div>
                        <p class="text-sm text-gray-500">Order ID:</p>
                        <p class="text-xl font-bold text-indigo-900 font-mono" id="display-order-id">ORD-XXXX</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">Estimated Delivery:</p>
                        <p class="text-lg font-bold text-gray-800" id="delivery-date">--</p>
                    </div>
                </div>

                <div class="relative px-4 py-8">
                    <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -translate-y-1/2 z-0 hidden md:block rounded-full"></div>
                    <div class="absolute top-1/2 left-0 h-1 bg-indigo-600 -translate-y-1/2 z-0 hidden md:block rounded-full step-line" id="progress-line" style="width: 0%"></div>

                    <div class="relative z-10 flex flex-col md:flex-row justify-between gap-8 md:gap-0">
                        <div class="step-item flex md:flex-col items-center gap-4 md:gap-2" id="step-1">
                            <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-200 bg-white flex items-center justify-center font-bold relative"><i class="fas fa-clipboard-check text-sm"></i></div>
                            <div class="md:text-center"><p class="font-bold text-sm">Placed</p><p class="text-xs text-gray-500 step-time">--:--</p></div>
                        </div>
                        <div class="step-item flex md:flex-col items-center gap-4 md:gap-2" id="step-2">
                            <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-200 bg-white flex items-center justify-center font-bold"><i class="fas fa-box-open text-sm"></i></div>
                            <div class="md:text-center"><p class="font-bold text-sm">Processing</p><p class="text-xs text-gray-500 step-time">--:--</p></div>
                        </div>
                        <div class="step-item flex md:flex-col items-center gap-4 md:gap-2" id="step-3">
                            <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-200 bg-white flex items-center justify-center font-bold"><i class="fas fa-shipping-fast text-sm"></i></div>
                            <div class="md:text-center"><p class="font-bold text-sm">Shipped</p><p class="text-xs text-gray-500 step-time">--:--</p></div>
                        </div>
                        <div class="step-item flex md:flex-col items-center gap-4 md:gap-2" id="step-4">
                            <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-200 bg-white flex items-center justify-center font-bold"><i class="fas fa-motorcycle text-sm"></i></div>
                            <div class="md:text-center"><p class="font-bold text-sm">Out for Delivery</p><p class="text-xs text-gray-500 step-time">--:--</p></div>
                        </div>
                        <div class="step-item flex md:flex-col items-center gap-4 md:gap-2" id="step-5">
                            <div class="step-circle w-10 h-10 rounded-full border-4 border-gray-200 bg-white flex items-center justify-center font-bold"><i class="fas fa-home text-sm"></i></div>
                            <div class="md:text-center"><p class="font-bold text-sm">Delivered</p><p class="text-xs text-gray-500 step-time">--:--</p></div>
                        </div>
                    </div>
                </div>
                <div id="status-message" class="mt-8 p-4 bg-indigo-50 text-indigo-700 rounded-lg text-center font-medium"></div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>
    <script src="navbar.js"></script>
    <script src="footer.js"></script>
    
    <script>
        const STEP_DURATION = 3 * 60 * 1000;

        function trackOrder() {
            const input = document.getElementById('order-id-input');
            const resultDiv = document.getElementById('tracking-result');
            const errorDiv = document.getElementById('error-message');
            const orderId = input.value.trim().toUpperCase();

            if(!orderId) return;
            const allOrders = JSON.parse(localStorage.getItem("allOrders")) || {};
            const orderData = allOrders[orderId];

            if (!orderData) {
                resultDiv.classList.add('hidden');
                errorDiv.classList.remove('hidden');
                return;
            }

            errorDiv.classList.add('hidden');
            document.getElementById('display-order-id').textContent = orderId;
            
            const startTime = orderData.date;
            const estimatedDelivery = new Date(startTime + (4 * STEP_DURATION));
            document.getElementById('delivery-date').textContent = estimatedDelivery.toDateString();

            resultDiv.classList.remove('hidden');
            setTimeout(() => resultDiv.classList.remove('opacity-0'), 50);

            if (window.trackingInterval) clearInterval(window.trackingInterval);
            updateStatus(startTime);
            window.trackingInterval = setInterval(() => updateStatus(startTime), 1000);
        }

        function updateStatus(startTime) {
            const now = Date.now();
            const elapsed = now - startTime;
            
            let currentStep = Math.floor(elapsed / STEP_DURATION) + 1;
            if (currentStep > 5) currentStep = 5;

            const progressLine = document.getElementById('progress-line');
            const width = Math.min(100, (elapsed / (4 * STEP_DURATION)) * 100);
            progressLine.style.width = width + '%';

            const messages = [
                "We have received your order and are preparing it for shipment.",
                "Your order is currently being packed in our warehouse.",
                "Your order has been shipped and is on its way to the hub.",
                "Our courier has picked up your package and is out for delivery.",
                "Package delivered successfully. Thank you for shopping!"
            ];

            document.getElementById('status-message').textContent = messages[currentStep - 1];

            for (let i = 1; i <= 5; i++) {
                const el = document.getElementById('step-' + i);
                const circle = el.querySelector('.step-circle');
                const timeEl = el.querySelector('.step-time');

                el.classList.remove('step-active', 'step-completed');
                circle.innerHTML = `<i class="${getIcon(i)} text-sm"></i>`;
                circle.classList.remove('animate-pulse-ring');

                if (i < currentStep) {
                    el.classList.add('step-completed');
                    circle.innerHTML = '<i class="fas fa-check"></i>';
                    const stepTime = new Date(startTime + ((i-1) * STEP_DURATION));
                    timeEl.textContent = stepTime.getHours().toString().padStart(2,'0') + ':' + stepTime.getMinutes().toString().padStart(2,'0');
                } else if (i === currentStep) {
                    el.classList.add('step-active');
                    circle.classList.add('animate-pulse-ring');
                    timeEl.textContent = "In Progress...";
                } else {
                    timeEl.textContent = "--:--";
                }
            }
        }

        function getIcon(step) {
            return ["fas fa-clipboard-check", "fas fa-box-open", "fas fa-shipping-fast", "fas fa-motorcycle", "fas fa-home"][step - 1];
        }
    </script>
</body>
</html>